# Starter pipeline
# Start with a minimal pipeline that you can customize to build and deploy your code.
# Add steps that build, run tests, deploy, and more:
# https://aka.ms/yaml

trigger:
- master

pool:
  vmImage: 'ubuntu-latest'

steps:
- task: Docker@0
  displayName: 'Build an image DockerHub'
  inputs:
    containerregistrytype: 'Container Registry'
    dockerRegistryConnection: 'ravikumar7206_dockerhub_other'
    action: 'Build an image'
    dockerFile: 'DemoApp/Dockerfile'
    imageName: 'ravikumar7206/demoapp:$(Build.BuildId)'
    includeLatestTag: true
- task: Docker@0
  displayName: 'Push an image Dockerhub'
  inputs:
    containerregistrytype: 'Container Registry'
    dockerRegistryConnection: 'ravikumar7206_dockerhub_other'
    action: 'Push an image'
    imageName: 'ravikumar7206/demoapp:$(Build.BuildId)'
    includeLatestTag: true
#----------- AKS Creation ------------------
# - task: AzureResourceManagerTemplateDeployment@3
#   inputs:
#     deploymentScope: 'Resource Group'
#     azureResourceManagerConnection: 'Free Trial(1)(8bc354b4-f372-41ce-a6c2-856ab22f5fcf)'
#     subscriptionId: '8bc354b4-f372-41ce-a6c2-856ab22f5fcf'
#     action: 'Create Or Update Resource Group'
#     resourceGroupName: 'rvrg'
#     location: 'East US'
#     templateLocation: 'Linked artifact'
#     csmFile: 'DemoApp/Manifest/aks_template.json'
#     csmParametersFile: 'DemoApp/Manifest/aks_parameters.json'
#     deploymentMode: 'Incremental'